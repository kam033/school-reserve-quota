# تحسينات اختيار المعلم البديل الذكي

## نظرة عامة

تم تحسين صفحة "غياب المعلمين" بإضافة نظام اختيار بديل ذكي يضمن توزيعًا عادلًا للحصص ويمنع إنهاك المعلمين.

---

## 🧠 الميزة الأولى: إشعار ذكي عند اختيار معلم لديه حصة قبل أو بعد

### الوصف
عند اختيار معلم بديل، يقوم النظام تلقائيًا بفحص جدول المعلم المختار للتحقق من وجود حصص متتالية.

### كيف يعمل؟
1. المستخدم يختار معلمًا بديلًا من القائمة المنسدلة
2. النظام يفحص تلقائيًا الحصص السابقة واللاحقة على نفس اليوم
3. إذا وُجدت حصة مباشرة قبل أو بعد:
   - يظهر تنبيه باللون الكهرماني (Amber Alert)
   - يحتوي التنبيه على أيقونة تحذير ⚠️
   - يعرض رقم الحصة المتعارضة واتجاهها (قبل/بعد)
   - يقترح اختيار معلم آخر

### مثال على الرسالة
```
⚠️ تنبيه: أحمد محمود لديه حصة في الحصة 3 (قبل)، يُفضَّل اختيار معلم آخر لضمان راحة المعلم.
```

### الفوائد
- ✅ يحافظ على صحة المعلمين من خلال تجنب الحصص المتتالية
- ✅ يضمن توزيعًا أكثر عدالة للحصص الاحتياطية
- ✅ يمنع الإرهاق والإنهاك للمعلمين
- ✅ المستخدم يمكنه تجاهل التنبيه والمتابعة إذا لزم الأمر

---

## 🧩 الميزة الثانية: أزرار تصفية ذكية لاختيار البديل

### الوصف
ثلاثة أزرار واضحة تتيح للمستخدم تصفية قائمة المعلمين البدلاء بناءً على معايير مختلفة.

### الأزرار الثلاثة

#### 1️⃣ حسب المادة 📘
- **الأيقونة**: BookOpen
- **الوظيفة**: يعرض فقط المعلمين الذين يدرّسون نفس المادة التي يدرّسها المعلم الغائب
- **الفائدة**: يضمن استمرارية تدريس المادة بواسطة معلم مختص

#### 2️⃣ حسب الصف 🏫
- **الأيقونة**: GraduationCap
- **الوظيفة**: يعرض فقط المعلمين الذين يدرّسون نفس الصف
- **الفائدة**: يساعد في اختيار معلم معتاد على المستوى الدراسي للطلاب

#### 3️⃣ الجدول العام 📋
- **الأيقونة**: Users
- **الوظيفة**: يعرض جميع المعلمين المتاحين في المدرسة
- **الفائدة**: يوفر أقصى مرونة عند عدم توفر معلمين مختصين

### خصائص التصفية

- **تفاعلية**: القائمة تتحدث فورًا عند الضغط على أي زر
- **مرئية**: الزر المفعّل يظهر بلون مميز (Primary Color)
- **تراكمية**: يمكن دمج التصفية مع معايير أخرى (مثل عدم وجود حصة متزامنة)
- **إعادة تعيين تلقائية**: عند تغيير المعلم الغائب، تعود التصفية إلى "الجدول العام"

### سلوك الأزرار

```typescript
// الزر يظهر فقط عند اختيار معلم وحصص
{selectedTeacherId && selectedPeriods.length > 0 && (
  <div className="flex gap-2 mb-3">
    {/* الأزرار الثلاثة */}
  </div>
)}
```

### الاستجابة على الموبايل
- الأزرار تتكيف تلقائيًا مع حجم الشاشة
- على الشاشات الصغيرة، تظل الأزرار في صف واحد بحجم مناسب
- الأيقونات تساعد في تحديد الوظيفة حتى على الشاشات الصغيرة

---

## 💡 التكامل مع النظام الحالي

### التحقق من التوافق
1. **جميع المعلمين المشغولين يتم استبعادهم تلقائيًا** قبل التصفية
2. **التصفية تطبق فقط على المعلمين المتاحين**
3. **النظام يحتفظ بجميع قواعد الأمان الموجودة** (منع الحجز المزدوج، وما إلى ذلك)

### تسلسل العمليات

```
اختيار المعلم الغائب
    ↓
اختيار اليوم والحصص
    ↓
استبعاد المعلمين المشغولين في نفس الحصة
    ↓
تطبيق التصفية (مادة/صف/الكل)
    ↓
عرض القائمة المصفاة
    ↓
اختيار معلم بديل
    ↓
فحص الحصص المتجاورة
    ↓
عرض التنبيه (إن وُجد)
    ↓
تأكيد الاختيار وحفظ البيانات
```

---

## 🎨 التصميم والواجهة

### الألوان المستخدمة

- **الزر المفعّل**: Primary Color (oklch(0.55 0.18 264))
- **الزر غير المفعّل**: Outline Variant
- **تنبيه الحصص المتجاورة**: Amber background (bg-amber-50) مع border (border-amber-500)
- **أيقونة التحذير**: Amber-600

### الأيقونات

| الأيقونة | الاستخدام | المصدر |
|----------|-----------|---------|
| BookOpen | التصفية حسب المادة | @phosphor-icons/react |
| GraduationCap | التصفية حسب الصف | @phosphor-icons/react |
| Users | الجدول العام | @phosphor-icons/react |
| Warning | أيقونة التنبيه | @phosphor-icons/react |

---

## 🔧 التفاصيل التقنية

### الدوال الرئيسية

#### `checkAdjacentPeriods(teacherId: string)`
تفحص إذا كان المعلم لديه حصة قبل أو بعد الحصة المطلوبة.

**المدخلات**:
- `teacherId`: معرّف المعلم المراد فحصه

**المخرجات**:
```typescript
{
  hasBefore: boolean,    // هل لديه حصة قبل؟
  hasAfter: boolean,     // هل لديه حصة بعد؟
  details: string[]      // تفاصيل الحصص المتعارضة
}
```

#### `getAbsentTeacherGrade()`
تحصل على الصف الدراسي الذي يدرّسه المعلم الغائب في الحصة المحددة.

**المخرجات**:
- `string | null`: اسم الصف أو null

#### `availableSubstitutes` (useMemo)
تحسب قائمة المعلمين البدلاء المتاحين بناءً على التصفية المختارة.

**الشروط**:
1. ليس مشغولاً في نفس الحصة
2. ليس هو المعلم الغائب نفسه
3. يطابق معايير التصفية المختارة (مادة/صف/الكل)

---

## 📱 التوافق

- ✅ Desktop: يعمل بشكل كامل
- ✅ Tablet: تخطيط متجاوب
- ✅ Mobile: أزرار قابلة للنقر بسهولة، نصوص واضحة
- ✅ RTL: دعم كامل للعربية من اليمين لليسار

---

## 🚀 الاستخدام

### مثال تطبيقي

1. المستخدم يختار "أحمد محمود" كمعلم غائب
2. يختار "الأحد" والحصة "4"
3. تظهر أزرار التصفية الثلاثة
4. يضغط على "حسب المادة" لرؤية معلمي الرياضيات فقط
5. يختار "خالد سعيد" كبديل
6. النظام يفحص جدول خالد ويجد أن لديه حصة 3 (قبل الحصة 4)
7. يظهر تنبيه: "⚠️ تنبيه: خالد سعيد لديه حصة في الحصة 3 (قبل)، يُفضَّل اختيار معلم آخر لضمان راحة المعلم."
8. المستخدم يقرر اختيار معلم آخر أو المتابعة

---

## 🎯 الأهداف المحققة

- ✅ واجهة تفاعلية ذكية تسهّل إدارة الغيابات
- ✅ اقتراحات أكثر دقة للمعلمين البدلاء
- ✅ نظام تحذير مدمج يحافظ على توازن الجهد بين المعلمين
- ✅ سهولة في التبديل بين أوضاع التصفية بضغطة زر واحدة
- ✅ منع الإرهاق من خلال اكتشاف الحصص المتتالية
- ✅ توزيع عادل للحصص الاحتياطية

---

## 🔄 تحديثات مستقبلية محتملة

- 📊 إضافة إحصائيات حول عدد الحصص البديلة لكل معلم
- 🎨 إضافة ألوان تدل على مستوى الإجهاد (أخضر/أصفر/أحمر)
- 📧 إرسال إشعارات للمعلمين البدلاء
- 📅 عرض التاريخ الكامل لغيابات المعلم
- 🔔 تنبيهات استباقية عند احتمال حدوث مشكلة
