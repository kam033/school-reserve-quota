# إصلاح مشكلة ترتيب الأيام في جدول المعلمين

## 📋 وصف المشكلة

بعد رفع ملف XML من aSc Timetables واعتماد الجدول، كانت الجداول لا تتطابق مع الجدول الأصلي في aSc. الاختلافات كانت واضحة خصوصاً:

- **يوم الأحد** لا تظهر حصصه نهائياً في النظام
- بعض الحصص تظهر في أيام خاطئة (حصة الأحد تظهر في الإثنين مثلاً)
- الترتيب داخل الجدول غير مطابق لتسلسل الحصص

## 🔍 السبب الجذري

### في aSc Timetables:
```xml
<day name="الأحد" short="احد" day="1"/>
<day name="الاثنين" short="اثنين" day="2"/>
<day name="الثلاثاء" short="ثلاثاء" day="3"/>
<day name="الأربعاء" short="اربعاء" day="4"/>
<day name="الخميس" short="خميس" day="5"/>
```

ترقيم الأيام في aSc Timetables يبدأ من **1** (الأحد) وينتهي عند **5** (الخميس).

### في النظام القديم:
```typescript
const daysOrder = ['0', '1', '2', '3', '4']
```

النظام كان يبحث عن أيام برقم 0-4، مما تسبب في:
- تجاهل يوم الأحد (day="1")
- إظهار يوم الإثنين (day="2") في عمود الأحد
- إظهار يوم الثلاثاء (day="3") في عمود الإثنين
- وهكذا... (انزياح كامل لجميع الأيام)

## ✅ الحل المطبق

### 1. تعديل TeacherSchedulesPage.tsx

**قبل:**
```typescript
const daysOrder = ['0', '1', '2', '3', '4']
```

**بعد:**
```typescript
const daysOrder = ['1', '2', '3', '4', '5']
```

هذا التغيير يضمن أن النظام يقرأ الأيام بنفس الترقيم المستخدم في aSc Timetables.

### 2. تحديث دليل التحضير (XMLGuide.tsx)

أُضيف قسم جديد (رقم 2) يوضح الترقيم الصحيح للأيام:

```
✓ day="1" → الأحد (Sunday)
✓ day="2" → الاثنين (Monday)
✓ day="3" → الثلاثاء (Tuesday)
✓ day="4" → الأربعاء (Wednesday)
✓ day="5" → الخميس (Thursday)
```

مع تحذير واضح للمستخدمين:
> **مهم جداً:** إذا كان ترقيم الأيام في ملف XML الخاص بك يبدأ من 0 (day="0" للأحد)، فقد تظهر الحصص في أيام خاطئة.

### 3. تحديث الملف النموذجي

تم تعديل ملف XML النموذجي القابل للتحميل ليستخدم الترقيم الصحيح (1-5 بدلاً من 0-4).

### 4. تحديث PRD

أُضيفت ملاحظات في:
- قسم Teacher Schedule Display: توضيح آلية عمل day ID mapping
- قسم Edge Case Handling: إضافة تعامل مع "Incorrect Day ID Mapping"

## 🧪 التحقق من الإصلاح

لاختبار أن الإصلاح يعمل بشكل صحيح:

1. **قم برفع ملف XML** من aSc Timetables يحتوي على أيام مرقمة 1-5
2. **اعتمد الجدول** بعد الرفع
3. **انتقل إلى "جدول المعلمين الأسبوعي"**
4. **اختر أي معلم** لديه حصص
5. **تحقق من:**
   - عمود الأحد (الأول) يعرض حصص day="1"
   - عمود الإثنين (الثاني) يعرض حصص day="2"
   - وهكذا...
6. **قارن مع الجدول الأصلي** في aSc Timetables

## 📝 الملفات المعدّلة

- ✅ `src/components/TeacherSchedulesPage.tsx` - تعديل ترتيب الأيام
- ✅ `src/components/XMLGuide.tsx` - إضافة قسم توضيحي + تحديث المثال
- ✅ `PRD.md` - توثيق التغييرات
- ✅ `DAY_MAPPING_FIX.md` - هذا الملف (توثيق شامل للإصلاح)

## 🎯 النتيجة المتوقعة

بعد هذا الإصلاح:

✓ يوم الأحد يظهر في العمود الأول مع جميع حصصه  
✓ جميع الأيام تطابق الجدول الأصلي في aSc Timetables تماماً  
✓ لا يوجد انزياح أو زحزحة في الحصص  
✓ كل خلية تعرض المادة والصف الصحيح في اليوم والحصة الصحيحة  

## ⚠️ ملاحظة مهمة للمستخدمين

إذا كان ملف XML الخاص بك يستخدم ترقيماً مختلفاً (مثل 0-4 بدلاً من 1-5)، يجب:

1. **فتح ملف XML** في محرر نصوص
2. **البحث عن** قسم `<days>`
3. **تعديل** ترقيم day من 0-4 إلى 1-5:
   ```xml
   <!-- قبل -->
   <day name="الأحد" day="0"/>
   
   <!-- بعد -->
   <day name="الأحد" day="1"/>
   ```
4. **حفظ** الملف ورفعه مرة أخرى

## 🔄 التوافق مع الإصدارات السابقة

هذا التغيير **غير متوافق** مع ملفات XML التي تستخدم ترقيم 0-4. إذا كنت قد رفعت جداول سابقة:

- الجداول القديمة ستستمر في العمل لكن قد تعرض أيام خاطئة
- يُنصح بحذف الجداول القديمة وإعادة رفعها بعد تعديل ترقيم الأيام
- أو استخدام النظام الجديد فقط للجداول الجديدة

---

**تاريخ الإصلاح:** 2024  
**الإصدار:** 1.1  
**الحالة:** ✅ مطبق ومختبر
