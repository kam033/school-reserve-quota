# ุฅุตูุงุญ ูุชูุนูู ุฒุฑ "ููุณ ุงูุตู" ูู ูุธุงู ุงูุญุตุต ุงูุงุญุชูุงุทูุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูุนูู ูุฅุตูุงุญ ุฒุฑ "ููุณ ุงูุตู" (Same Grade Filter) ุจุดูู ูุงูู ูู ุตูุญุฉ ุบูุงุจ ุงููุนูููู. ุงูุฒุฑ ุงูุขู ูุนูู ุจุดูู ุตุญูุญ ููุนุฑุถ ุงููุนูููู ุงูุฐูู ูุฏุฑูุณูู ููุณ ุงูุตู ุงูุฏุฑุงุณู ูููุนูู ุงูุบุงุฆุจ.

## ๐ง ุงูุชุบููุฑุงุช ุงูุชูููุฉ

### 1. ุฅุตูุงุญ XML Parser (`src/lib/xmlParser.ts`)

#### ุงููุดููุฉ ุงูุณุงุจูุฉ
- ูุงู ูุชู ุชุญููู ุจูุงูุงุช `TimeTableSchedule` ูู ููู XML
- ููู ูู ูุชู ุชุญููู ูุฐู ุงูุจูุงูุงุช ุฅูู `Period[]` ูุน ูุนูููุงุช `className`
- ูุชูุฌุฉ ูุฐููุ ูู ุชูู ูุนูููุงุช ุงูุตู ูุชุงุญุฉ ููููุชุฑุฉ

#### ุงูุญู ุงููุทุจู

**ุชุบููุฑ 1: ุชุฎุฒูู ุฃููุงุช ุงูุญุตุต ูู Map**
```typescript
// ูุจู: ูุงู ูุชู ุฅูุดุงุก Period ูุงุฑุบุฉ
const periodElements = xmlDoc.querySelectorAll('period')
periodElements.forEach((periodEl) => {
  periods.push({
    id: `${schoolId}-period-${period}`,
    day: '',
    periodNumber: parseInt(period) || 0,
    teacherId: '',
    subject: '',
    startTime: starttime,
    endTime: endtime,
  })
})

// ุจุนุฏ: ุชุฎุฒูู ุงูุฃููุงุช ูู Map ูุงุณุชุฎุฏุงููุง ูุงุญูุงู
const periodTimings = new Map<number, { startTime: string; endTime: string }>()
const periodElements = xmlDoc.querySelectorAll('period')
periodElements.forEach((periodEl) => {
  const period = periodEl.getAttribute('period') || '0'
  const starttime = periodEl.getAttribute('starttime') || ''
  const endtime = periodEl.getAttribute('endtime') || ''

  periodTimings.set(parseInt(period) || 0, {
    startTime: starttime,
    endTime: endtime,
  })
})
```

**ุชุบููุฑ 2: ููุก periods ูู TimeTableSchedule ูุน className**
```typescript
scheduleElements.forEach((scheduleEl, index) => {
  // ... ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู XML ...

  // ุฅุถุงูุฉ ุฅูู schedules
  schedules.push({
    id: `${schoolId}-schedule-${index}`,
    dayID,
    period: parseInt(period) || 0,
    // ... ุจููุฉ ุงูุญููู
  })

  // โจ ุฌุฏูุฏ: ุฅูุดุงุก Period ูุงูู ูุน ูุนูููุงุช ุงูุตู
  const day = days.find((d) => d.day === dayID)
  const subject = subjects.find((s) => s.originalId === subjectGradeID)
  const classObj = classes.find((c) => c.originalId === classID)
  const timing = periodTimings.get(parseInt(period) || 0)

  periods.push({
    id: `${schoolId}-period-${index}`,
    day: day?.name || '',
    periodNumber: parseInt(period) || 0,
    teacherId: `${schoolId}-${teacherID}`,
    subject: subject?.name || '',
    className: classObj?.name || '',  // โญ ุงููุนูููุฉ ุงูุฃุณุงุณูุฉ ูููุชุฑ "ููุณ ุงูุตู"
    startTime: timing?.startTime || '',
    endTime: timing?.endTime || '',
  })
})
```

### 2. ุชุญุณูู ุฏุงูุฉ `getAbsentTeacherGrade()` (`src/components/AbsencePage.tsx`)

#### ุงูุชุญุณููุงุช
- ุฅุถุงูุฉ console.log ููุณุงุนุฏุฉ ูู ุงูุชุดุฎูุต
- ุงูุชุนุงูู ูุน ุญุงูุงุช ูุชุนุฏุฏุฉ ูู ุงูุตููู ูููุณ ุงููุนูู
- ุฅุฑุฌุงุน ุฃูู ุตู ุชู ุงูุนุซูุฑ ุนููู

```typescript
function getAbsentTeacherGrade(): string | null {
  if (!selectedTeacherId || approvedSchedules.length === 0 || selectedPeriods.length === 0) return null
  
  const gradesFound = new Set<string>()
  
  for (const schedule of approvedSchedules) {
    if (!schedule.periods || !Array.isArray(schedule.periods)) continue
    
    for (const period of schedule.periods) {
      if (period.teacherId === selectedTeacherId && 
          period.day === selectedDay && 
          selectedPeriods.includes(period.periodNumber) &&
          period.className) {
        gradesFound.add(period.className)
      }
    }
  }
  
  if (gradesFound.size > 0) {
    const grades = Array.from(gradesFound)
    console.log('Grades found for absent teacher:', grades)
    return grades[0]  // ุฅุฑุฌุงุน ุฃูู ุตู
  }
  
  return null
}
```

### 3. ุชุญุณูู ูุงุฌูุฉ ุงููุณุชุฎุฏู

#### ุฅุถุงูุฉ ุฑุณุงุฆู ุชูุถูุญูุฉ
```typescript
// ุนูุฏ ุชูุนูู ููุชุฑ "ููุณ ุงูุตู"
{filterMode === 'grade' && getAbsentTeacherGrade() && (
  <div className="text-xs text-muted-foreground bg-purple-50 border border-purple-200 px-3 py-2 rounded-md">
    ๐ซ ุนุฑุถ ุงููุนูููู ุงููุชูุฑุบูู ุงูุฐูู ูุฏุฑูุณูู ููุณ ุงูุตู: <span className="font-medium text-foreground">{getAbsentTeacherGrade()}</span>
    <div className="mt-1 text-[10px]">
      ๐ ุงููุนูููู ุงููุนุฑูุถูู ูุฏุฑูุณูู ูุฐุง ุงูุตู (ุฃู ูุงุฏุฉ) ููุชูุฑุบูู ูู ุงูููุช ุงููุทููุจ
    </div>
  </div>
)}

// ุนูุฏูุง ูุง ูููู ููุงู ุตู ูุญุฏุฏ (ุงูุฒุฑ ูุนุทู)
{!getAbsentTeacherGrade() && selectedTeacherId && selectedPeriods.length > 0 && (
  <div className="text-xs text-amber-700 bg-amber-50 border border-amber-200 px-3 py-2 rounded-md">
    โน๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุตู ูุญุฏุฏ ูููุนูู ูู ุงูุญุตุต ุงููุฎุชุงุฑุฉ. ุงูุฒุฑ "ููุณ ุงูุตู" ูุนุทู.
  </div>
)}
```

#### ุฅุถุงูุฉ tooltip ููุฒุฑ
```typescript
<Button
  type="button"
  variant={filterMode === 'grade' ? 'default' : 'outline'}
  size="sm"
  onClick={() => setFilterMode('grade')}
  className="flex-1 gap-2"
  disabled={!getAbsentTeacherGrade()}
  title={!getAbsentTeacherGrade() ? 'ูุง ููุฌุฏ ุตู ูุญุฏุฏ ูููุนูู ูู ุงูุญุตุต ุงููุฎุชุงุฑุฉ' : ''}
>
  <GraduationCap className="w-4 h-4" />
  ููุณ ุงูุตู
</Button>
```

## ๐ฏ ููููุฉ ุนูู ุงูููุชุฑ

### ุขููุฉ ุงูุนูู ุฎุทูุฉ ุจุฎุทูุฉ

1. **ุงููุณุชุฎุฏู ูุฎุชุงุฑ ูุนูู ุบุงุฆุจ** โ ุงููุธุงู ูุญุฏุฏ ID ุงููุนูู
2. **ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุงูุญุตุต** โ ุงููุธุงู ูุญุฏุฏ ุฃุฑูุงู ุงูุญุตุต
3. **ุงููุธุงู ูุจุญุซ ุนู ุงูุตู**:
   ```
   - ููุชุด ูู ุฌููุน ุงูู periods
   - ูุจุญุซ ุนู periods ุญูุซ:
     * teacherId = ุงููุนูู ุงูุบุงุฆุจ
     * day = ุงูููู ุงููุฎุชุงุฑ
     * periodNumber = ุถูู ุงูุญุตุต ุงููุฎุชุงุฑุฉ
   - ูุณุชุฎุฑุฌ className ูู ูุฐู ุงูู periods
   ```
4. **ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ "ููุณ ุงูุตู"**:
   ```
   - ุงููุธุงู ูุฌูุน ุฌููุน ุงููุนูููู ุงูุฐูู ูุฏุฑูุณูู ููุณ ุงูุตู
   - ูููุชุฑ ูุคูุงุก ุงููุนูููู ุญุณุจ ุงูุชูุฑุบ:
     * ูุง ุญุตุฉ ูู ููุณ ุงูููุช
     * ูุง ุญุตุฉ ูุจู ุงูุญุตุฉ ุงููุฎุชุงุฑุฉ
     * ูุง ุญุตุฉ ุจุนุฏ ุงูุญุตุฉ ุงููุฎุชุงุฑุฉ
   - ูุนุฑุถ ุงููุงุฆูุฉ ุงูููุงุฆูุฉ
   ```

### ูุซุงู ุนููู

**ุงูุณููุงุฑูู:**
- ุงููุนูู ุงูุบุงุฆุจ: ุฃ. ูุญูุฏ (ูุฏุฑูุณ ุงูุตู 11 ุนููู)
- ุงูููู: ุงูุฃุญุฏ
- ุงูุญุตุฉ: 3

**ุนูุฏ ุงูุถุบุท ุนูู "ููุณ ุงูุตู":**
```
1. ุงููุธุงู ูุญุฏุฏ ุฃู ุฃ. ูุญูุฏ ูุฏุฑูุณ "11 ุนููู" ูู ุงูุญุตุฉ 3 ููู ุงูุฃุญุฏ
2. ุงููุธุงู ูุจุญุซ ุนู ุฌููุน ุงููุนูููู ุงูุฐูู ูุฏุฑูุณูู "11 ุนููู" (ุฃู ูุงุฏุฉ)
3. ูู ูุคูุงุก ุงููุนููููุ ูููุชุฑ ููุท ูู:
   - ููุณ ูุฏูู ุญุตุฉ ูู ุงูุญุตุฉ 3 ููู ุงูุฃุญุฏ
   - ููุณ ูุฏูู ุญุตุฉ ูู ุงูุญุตุฉ 2 (ูุจููุง)
   - ููุณ ูุฏูู ุญุตุฉ ูู ุงูุญุตุฉ 4 (ุจุนุฏูุง)
4. ูุนุฑุถ ุงููุงุฆูุฉ ุงูููุงุฆูุฉ ูุน ุนุฏุฏูู
```

## โ ูุนุงููุฑ ุงููุฌุงุญ

- [x] ุงูุฒุฑ "ููุณ ุงูุตู" ูุธูุฑ ุจุดูู ุตุญูุญ
- [x] ุงูุฒุฑ ูุนุทู ุนูุฏูุง ูุง ูููู ููุงู ุตู ูููุนูู ุงูุบุงุฆุจ
- [x] ุงูุฒุฑ ูุนูู ุนูุฏ ุงูุถุบุท ุนููู
- [x] ุงูููุชุฑุฉ ุชุชู ุจุดูู ุตุญูุญ (ููุณ ุงูุตู + ูุชูุฑุบ)
- [x] ุงูุนุฏุฏ ูุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุงูุชุจุฏูู ุจูู ุงูููุงุชุฑ
- [x] ุฑุณุงุฆู ุชูุถูุญูุฉ ุชุธูุฑ ูููุณุชุฎุฏู
- [x] console.log ูุณุงุนุฏ ูู ุงูุชุดุฎูุต
- [x] ุงูุชูุซูู ูุงูู ููุงุถุญ

## ๐ ุงุฎุชุจุงุฑ ุงูููุฒุฉ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ
1. ุงุฑูุน ููู XML ูุญุชูู ุนูู ูุนูููู ูุตููู
2. ุงุนุชูุฏ ุงูุฌุฏูู
3. ุงูุชูู ุฅูู ุตูุญุฉ "ุบูุงุจ ุงููุนูููู"
4. ุงุฎุชุฑ ูุนูู ุบุงุฆุจ
5. ุงุฎุชุฑ ููู ูุญุตุฉ
6. ุงููุฑ ุนูู ุฒุฑ "ููุณ ุงูุตู"
7. ุชุญูู ูู:
   - ุธููุฑ ุงูุฑุณุงูุฉ ุงูุชูุถูุญูุฉ ุจุงุณู ุงูุตู
   - ุนุฑุถ ุงููุนูููู ุงููุชูุฑุบูู ุงูุฐูู ูุฏุฑูุณูู ููุณ ุงูุตู
   - ุงูุนุฏุฏ ุงูุตุญูุญ ูููุนูููู ุงููุชูุฑุบูู

### ุญุงูุงุช ุฎุงุตุฉ ููุงุฎุชุจุงุฑ
- **ูุง ููุฌุฏ ุตู**: ุงูุฒุฑ ูุนุทู ูุฑุณุงูุฉ ุชูุถูุญูุฉ ุชุธูุฑ
- **ูุง ููุฌุฏ ูุนูููู ูุชูุฑุบูู**: ุฑุณุงูุฉ "ูุง ููุฌุฏ ูุนูููู ูุชูุฑุบูู" ุชุธูุฑ
- **ุงูุชุจุฏูู ุจูู ุงูููุงุชุฑ**: ุงูุนุฏุฏ ูุงููุงุฆูุฉ ุชุชุญุฏุซ ููุฑุงู

## ๐ ุงููุฑู ุจูู ุงูุฃุฒุฑุงุฑ ุงูุซูุงุซุฉ

| ุงูุฒุฑ | ุงููุธููุฉ | ูุชู ููุณุชุฎุฏู |
|------|---------|-------------|
| **ุงูุฌุฏูู ุงูุนุงู** | ูุนุฑุถ ุฌููุน ุงููุนูููู ุงููุชูุฑุบูู | ุนูุฏูุง ูุง ููู ุงูุชุฎุตุต ุฃู ุงูุตู |
| **ููุณ ุงููุงุฏุฉ** | ูุนุฑุถ ุงููุนูููู ุงูุฐูู ูุฏุฑูุณูู ููุณ ุงููุงุฏุฉ | ุนูุฏูุง ุชุญุชุงุฌ ุจุฏูู ูู ููุณ ุงูุชุฎุตุต |
| **ููุณ ุงูุตู** | ูุนุฑุถ ุงููุนูููู ุงูุฐูู ูุฏุฑูุณูู ููุณ ุงูุตู | ุนูุฏูุง ุชุญุชุงุฌ ุจุฏูู ูุนุฑู ุทูุงุจ ุงูุตู |

## ๐ ููุงุฆุฏ ุงุณุชุฎุฏุงู "ููุณ ุงูุตู"

1. **ุงููุนูู ุงูุจุฏูู ูุนุฑู ุงูุทูุงุจ** - ุณูููุฉ ูู ุฅุฏุงุฑุฉ ุงูุตู
2. **ุงูุทูุงุจ ูุนุฑููู ุงููุนูู ุงูุจุฏูู** - ุฑุงุญุฉ ุฃูุจุฑ ููุทูุงุจ
3. **ุชูุฒูุน ุนุงุฏู** - ูุฑุตุฉ ูุฌููุน ูุนููู ุงูุตู ูููุดุงุฑูุฉ
4. **ูุฑููุฉ ูู ุงููุงุฏุฉ** - ูุง ูุดุชุฑุท ููุณ ุงูุชุฎุตุต

## ๐ ุงูุชูุงูู ูุน ุจููุฉ ุงููุธุงู

- โ ูุชูุงูู ูุน ูุธุงู ุงูุชูุฑุบ (ูุง ุญุตุฉ ูุจู/ุฃุซูุงุก/ุจุนุฏ)
- โ ูุชูุงูู ูุน ูุธุงู ุงูุชุญุฐูุฑุงุช (ุญุตุฉ ูุชุฌุงูุฑุฉ)
- โ ูุชูุงูู ูุน ุนุฏุงุฏ ุงููุนูููู ุงููุชูุฑุบูู
- โ ูุชูุงูู ูุน ูุธุงู ุงูุฅุญุตุงุฆูุงุช
- โ ูุญุชุฑู ุงูุฌุฏุงูู ุงููุนุชูุฏุฉ ููุท

## ๐ ููุงุญุธุงุช ูููุทูุฑูู

- `className` ูู `Period` ุชูููุฃ ูู `classID` ูู `TimeTableSchedule`
- ุงูููุชุฑุฉ ุชุชู ูู `availableSubstitutes` useMemo
- ุงูุฒุฑ ูุนุทู ุนูุฏ `!getAbsentTeacherGrade()`
- console.log ููุฌูุฏ ูููุณุงุนุฏุฉ ูู ุงูุชุดุฎูุต
- ุงูููุฏ ูุฏุนู ูุนูู ูุฏุฑูุณ ุตููู ูุชุนุฏุฏุฉ (ูุฃุฎุฐ ุงูุฃูู)

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ ุงูููุชุฑุญุฉ

- [ ] ุนุฑุถ ุฌููุน ุงูุตููู ุฅุฐุง ูุงู ุงููุนูู ูุฏุฑูุณ ุตููู ูุชุนุฏุฏุฉ ูู ุงูุญุตุต ุงููุฎุชุงุฑุฉ
- [ ] ุฅุถุงูุฉ ููุชุฑ ูุฑูุจ (ููุณ ุงููุงุฏุฉ + ููุณ ุงูุตู)
- [ ] ุนุฑุถ ุฅุญุตุงุฆูุงุช: ูู ูุนูู ููู ุตู ูุชูุฑุบ
- [ ] ุญูุธ ุชูุถูู ุงููุณุชุฎุฏู ููููุชุฑ ุงูุงูุชุฑุงุถู
- [ ] ุฅุถุงูุฉ ุฃููููุฉ ุตุบูุฑุฉ ุจุฌุงูุจ ุงุณู ุงููุนูู ุงูุจุฏูู ุชูุถุญ ุฃูู ูู ููุณ ุงูุตู

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** ุงูููู  
**ุงูุญุงูุฉ:** โ ููุชูู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู  
**ุงููุทูุฑ:** Spark Agent
